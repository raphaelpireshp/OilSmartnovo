-- Criação do banco de dados OilSmart
CREATE DATABASE IF NOT EXISTS OilSmart;
USE OilSmart;



-- Tabela de usuários
CREATE TABLE usuario (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    senha VARCHAR(255) NOT NULL,
    tipo ENUM('cliente', 'oficina', 'funcionario') NOT NULL,
    telefone VARCHAR(20),
    cpf VARCHAR(14) UNIQUE,
    cnpj VARCHAR(18) UNIQUE,
    endereco VARCHAR(255),
    cep VARCHAR(9),
    cidade VARCHAR(100),
    estado VARCHAR(2),
    data_cadastro DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de marcas de veículos
CREATE TABLE marca (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL UNIQUE
);

-- Tabela de modelos de veículos
CREATE TABLE modelo (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    marca_id INT NOT NULL,
    tipo ENUM('carro', 'moto') NOT NULL,
    FOREIGN KEY (marca_id) REFERENCES marca(id) ON DELETE CASCADE
);

-- Tabela de anos dos modelos
CREATE TABLE modelo_ano (
    id INT AUTO_INCREMENT PRIMARY KEY,
    modelo_id INT NOT NULL,
    ano INT NOT NULL,
    FOREIGN KEY (modelo_id) REFERENCES modelo(id) ON DELETE CASCADE
);

-- Tabela de veículos dos clientes
CREATE TABLE veiculo (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_id INT NOT NULL,
    modelo_ano_id INT NOT NULL,
    placa VARCHAR(10),
    quilometragem INT,
    data_cadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (usuario_id) REFERENCES usuario(id) ON DELETE CASCADE,
    FOREIGN KEY (modelo_ano_id) REFERENCES modelo_ano(id) ON DELETE CASCADE
);

-- Tabela de oficinas
CREATE TABLE oficina (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_id INT NOT NULL,
    nome VARCHAR(100) NOT NULL,
    cep VARCHAR(9) NOT NULL,
    endereco VARCHAR(255),
    cidade VARCHAR(100),
    estado VARCHAR(2),
    horario_abertura TIME,
    horario_fechamento TIME,
    dias_funcionamento VARCHAR(50),
    FOREIGN KEY (usuario_id) REFERENCES usuario(id) ON DELETE CASCADE
);

-- Tabela de funcionários
CREATE TABLE funcionario (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_id INT NOT NULL,
    oficina_id INT NOT NULL,
    cargo VARCHAR(50),
    FOREIGN KEY (usuario_id) REFERENCES usuario(id) ON DELETE CASCADE,
    FOREIGN KEY (oficina_id) REFERENCES oficina(id) ON DELETE CASCADE
);

-- Tabela de produtos (óleos)
CREATE TABLE produto_oleo (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    tipo ENUM('carro', 'moto') NOT NULL,
    viscosidade VARCHAR(20),
    especificacao VARCHAR(255),
    marca VARCHAR(100)
);

-- Tabela de produtos (filtros)
CREATE TABLE produto_filtro (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    tipo ENUM('carro', 'moto') NOT NULL,
    compatibilidade_modelo VARCHAR(255)
);

-- Tabela de estoque
CREATE TABLE estoque (
    id INT AUTO_INCREMENT PRIMARY KEY,
    oficina_id INT NOT NULL,
    produto_id INT NOT NULL,
    tipo_produto ENUM('oleo', 'filtro') NOT NULL,
    quantidade INT NOT NULL DEFAULT 0,
    FOREIGN KEY (oficina_id) REFERENCES oficina(id) ON DELETE CASCADE
);

-- Tabela de recomendações
CREATE TABLE recomendacao (
    id INT AUTO_INCREMENT PRIMARY KEY,
    modelo_ano_id INT NOT NULL,
    oleo_id INT,
    filtro_id INT,
    FOREIGN KEY (modelo_ano_id) REFERENCES modelo_ano(id) ON DELETE CASCADE,
    FOREIGN KEY (oleo_id) REFERENCES produto_oleo(id) ON DELETE SET NULL,
    FOREIGN KEY (filtro_id) REFERENCES produto_filtro(id) ON DELETE SET NULL
);

-- Tabela de agendamentos
CREATE TABLE agendamento (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cliente_id INT NOT NULL,
    oficina_id INT NOT NULL,
    veiculo_id INT NOT NULL,
    funcionario_id INT,
    data_agendamento DATETIME NOT NULL,
    status ENUM('pendente', 'confirmado', 'cancelado', 'concluido') DEFAULT 'pendente',
    codigo_confirmacao VARCHAR(10) UNIQUE,
    data_criacao DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (cliente_id) REFERENCES usuario(id) ON DELETE CASCADE,
    FOREIGN KEY (oficina_id) REFERENCES oficina(id) ON DELETE CASCADE,
    FOREIGN KEY (veiculo_id) REFERENCES veiculo(id) ON DELETE CASCADE,
    FOREIGN KEY (funcionario_id) REFERENCES funcionario(id) ON DELETE SET NULL
);

-- Tabela de divergências
CREATE TABLE divergencia (
    id INT AUTO_INCREMENT PRIMARY KEY,
    agendamento_id INT NOT NULL,
    descricao TEXT NOT NULL,
    resolvido BOOLEAN DEFAULT FALSE,
    data_criacao DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (agendamento_id) REFERENCES agendamento(id) ON DELETE CASCADE
);

-- Inserção de dados iniciais

-- Inserir usuários administradores das oficinas
INSERT INTO usuario (nome, email, senha, tipo, telefone, cnpj) VALUES 
('Oficina Norte', 'adm_norte@motul.com', '$2a$10$xJwL5v5z5U6ZU5Z5Z5Z5Zu', 'oficina', '(11) 1234-5678', '12.345.678/0001-90'),
('Oficina Sul', 'adm_sul@motul.com', '$2a$10$xJwL5v5z5U6ZU5Z5Z5Z5Zu', 'oficina', '(11) 2345-6789', '23.456.789/0001-01'),
('Oficina Leste', 'adm_leste@motul.com', '$2a$10$xJwL5v5z5U6ZU5Z5Z5Z5Zu', 'oficina', '(11) 3456-7890', '34.567.890/0001-12');

-- Inserir oficinas
INSERT INTO oficina (usuario_id, nome, cep, endereco, cidade, estado, horario_abertura, horario_fechamento, dias_funcionamento) VALUES 
(1, 'Motul Oficina Norte', '02430-000', 'Rua Exemplo Norte, 123', 'São Paulo', 'SP', '08:00:00', '17:00:00', 'Seg-Sex'),
(2, 'Motul Oficina Sul', '04783-100', 'Rua Exemplo Sul, 456', 'São Paulo', 'SP', '09:00:00', '18:00:00', 'Seg-Sab'),
(3, 'Motul Oficina Leste', '03675-040', 'Rua Exemplo Leste, 789', 'São Paulo', 'SP', '10:00:00', '20:00:00', 'Seg-Sex');

-- Inserir marcas de veículos
INSERT INTO marca (nome) VALUES 
('Fiat'), ('Ford'), ('Chevrolet'), ('Volkswagen'), ('Toyota'), 
('Honda'), ('Hyundai'), ('Renault'), ('Peugeot'), ('Nissan'), ('Jeep'),
('Yamaha'), ('Suzuki'), ('Kawasaki'), ('Harley-Davidson');

-- Inserir modelos de carros
INSERT INTO modelo (nome, marca_id, tipo) VALUES 
('Palio', 1, 'carro'), ('Uno', 1, 'carro'), ('Strada', 1, 'carro'), ('Toro', 1, 'carro'),
('Ka', 2, 'carro'), ('Fiesta', 2, 'carro'), ('EcoSport', 2, 'carro'), ('Focus', 2, 'carro'),
('Onix', 3, 'carro'), ('Celta', 3, 'carro'), ('Prisma', 3, 'carro'), ('S10', 3, 'carro'),
('Gol', 4, 'carro'), ('Voyage', 4, 'carro'), ('Saveiro', 4, 'carro'), ('Polo', 4, 'carro'),
('Corolla', 5, 'carro'), ('Hilux', 5, 'carro'), ('Etios', 5, 'carro'), ('Yaris', 5, 'carro'),
('Civic', 6, 'carro'), ('Fit', 6, 'carro'), ('HR-V', 6, 'carro'), ('CR-V', 6, 'carro'),
('HB20', 7, 'carro'), ('Creta', 7, 'carro'), ('Tucson', 7, 'carro'), ('Santa Fe', 7, 'carro'),
('Kwid', 8, 'carro'), ('Sandero', 8, 'carro'), ('Logan', 8, 'carro'), ('Duster', 8, 'carro'),
('208', 9, 'carro'), ('2008', 9, 'carro'), ('3008', 9, 'carro'), ('Partner', 9, 'carro'),
('March', 10, 'carro'), ('Versa', 10, 'carro'), ('Kicks', 10, 'carro'), ('Frontier', 10, 'carro'),
('Renegade', 11, 'carro'), ('Compass', 11, 'carro'), ('Commander', 11, 'carro'), ('Wrangler', 11, 'carro');

-- Inserir modelos de motos
INSERT INTO modelo (nome, marca_id, tipo) VALUES 
('CG 160', 12, 'moto'), ('Fazer 250', 12, 'moto'), ('MT-03', 12, 'moto'), ('XTZ 250', 12, 'moto'),
('Bandit 125', 13, 'moto'), ('Burgman 125', 13, 'moto'), ('GSX-S750', 13, 'moto'), ('V-Strom 650', 13, 'moto'),
('Ninja 300', 14, 'moto'), ('Z400', 14, 'moto'), ('Versys 650', 14, 'moto'), ('Z900', 14, 'moto'),
('Iron 883', 15, 'moto'), ('Street 750', 15, 'moto'), ('Fat Boy', 15, 'moto'), ('Road King', 15, 'moto');

-- Inserir anos dos modelos
INSERT INTO modelo_ano (modelo_id, ano) VALUES 
(1, 2020), (1, 2021), (1, 2022),
(2, 2020), (2, 2021), (2, 2022),
(3, 2021), (3, 2022),
(4, 2020), (4, 2021), (4, 2022),
(5, 2021), (5, 2022),
(6, 2020), (6, 2021), (6, 2022),
(7, 2021), (7, 2022),
(8, 2020), (8, 2021), (8, 2022),
(9, 2021), (9, 2022),
(10, 2020), (10, 2021), (10, 2022),
(41, 2021), (41, 2022), (41, 2023),
(42, 2022), (42, 2023),
(43, 2021), (43, 2022), (43, 2023),
(44, 2022), (44, 2023);

-- Inserir produtos (óleos)
INSERT INTO produto_oleo (nome, tipo, viscosidade, especificacao, marca) VALUES 
('Motul 8100 X-clean 5W-30', 'carro', '5W-30', 'API SN, Full Sintético', 'Motul'),
('Motul 8100 Eco 10W-40', 'carro', '10W-40', 'API SN, Semissintético', 'Motul'),
('Motul 300V Factory Line 10W-40', 'moto', '10W-40', 'Ester Core, Racing', 'Motul'),
('Motul Scooter Expert 10W-30', 'moto', '10W-30', 'JASO MB, Scooters', 'Motul'),
('Motul 8100 Eco-nergy 5W-30', 'carro', '5W-30', 'API SP, Low SAPS', 'Motul'),
('Motul 7100 20W-50', 'moto', '20W-50', 'API SL, JASO MA2', 'Motul');

-- Inserir produtos (filtros)
INSERT INTO produto_filtro (nome, tipo, compatibilidade_modelo) VALUES 
('Filtro A123', 'carro', 'Fiat Palio, Uno; VW Gol, Voyage'),
('Filtro B456', 'carro', 'Ford Ka, Fiesta; Chevrolet Onix, Prisma'),
('Filtro C789', 'carro', 'Toyota Corolla, Etios; Honda Civic, Fit'),
('Filtro MOTO-X90', 'moto', 'Yamaha CG 160, Fazer 250; Honda CG 150, CB 300'),
('Filtro SCOOTER-40', 'moto', 'Yamaha NMax, XMax; Honda PCX, Forza');

-- Inserir estoque para as oficinas
-- Oficina Norte
INSERT INTO estoque (oficina_id, produto_id, tipo_produto, quantidade) VALUES 
(1, 1, 'oleo', 20), (1, 2, 'oleo', 15), (1, 3, 'oleo', 10), (1, 4, 'oleo', 8),
(1, 1, 'filtro', 30), (1, 2, 'filtro', 25), (1, 3, 'filtro', 20), (1, 4, 'filtro', 15);

-- Oficina Sul
INSERT INTO estoque (oficina_id, produto_id, tipo_produto, quantidade) VALUES 
(2, 1, 'oleo', 25), (2, 2, 'oleo', 20), (2, 5, 'oleo', 15), (2, 6, 'oleo', 10),
(2, 1, 'filtro', 35), (2, 2, 'filtro', 30), (2, 5, 'filtro', 20), (2, 4, 'filtro', 15);

-- Oficina Leste
INSERT INTO estoque (oficina_id, produto_id, tipo_produto, quantidade) VALUES 
(3, 1, 'oleo', 30), (3, 2, 'oleo', 25), (3, 3, 'oleo', 20), (3, 6, 'oleo', 15),
(3, 1, 'filtro', 40), (3, 2, 'filtro', 35), (3, 3, 'filtro', 30), (3, 5, 'filtro', 20);

-- Inserir recomendações
INSERT INTO recomendacao (modelo_ano_id, oleo_id, filtro_id) VALUES 
(1, 1, 1),  -- Palio 2020
(2, 1, 1),  -- Palio 2021
(3, 1, 1),  -- Palio 2022
(4, 2, 1),  -- Uno 2020
(5, 2, 1),  -- Uno 2021
(6, 2, 1),  -- Uno 2022
(7, 2, 1),  -- Strada 2021
(8, 2, 1),  -- Strada 2022
(9, 1, 2),  -- Toro 2020
(10, 1, 2) -- Toro 2021


-- Inserir funcionários
INSERT INTO usuario (nome, email, senha, tipo, telefone, cpf) VALUES 
('João Silva', 'joao@oficinanorte.com', '$2a$10$xJwL5v5z5U6ZU5Z5Z5Z5Zu', 'funcionario', '(11) 98765-4321', '123.456.789-00'),
('Maria Santos', 'maria@oficinasul.com', '$2a$10$xJwL5v5z5U6ZU5Z5Z5Z5Zu', 'funcionario', '(11) 98765-4322', '234.567.890-11'),
('Carlos Oliveira', 'carlos@oficinaleste.com', '$2a$10$xJwL5v5z5U6ZU5Z5Z5Z5Zu', 'funcionario', '(11) 98765-4323', '345.678.901-22');

INSERT INTO funcionario (usuario_id, oficina_id, cargo) VALUES 
(4, 1, 'Mecânico Chefe'),
(5, 2, 'Gerente'),
(6, 3, 'Mecânico');

-- Inserir um cliente de exemplo
INSERT INTO usuario (nome, email, senha, tipo, telefone, cpf, endereco, cep, cidade, estado) VALUES 
('Cliente Exemplo', 'cliente@exemplo.com', '$2a$10$xJwL5v5z5U6ZU5Z5Z5Z5Zu', 'cliente', '(11) 98765-0001', '987.654.321-00', 'Rua Cliente, 123', '01234-567', 'São Paulo', 'SP');

-- Inserir um veículo para o cliente
INSERT INTO veiculo (usuario_id, modelo_ano_id, placa, quilometragem) VALUES 
(7, 1, 'ABC1D23', 25000);  -- Palio 2020

-- Inserir um agendamento de exemplo
INSERT INTO agendamento (cliente_id, oficina_id, veiculo_id, funcionario_id, data_agendamento, status, codigo_confirmacao) VALUES 
(7, 1, 1, 1, '2023-12-15 10:00:00', 'confirmado', 'ABCD1234');



SHOW TABLES;
ALTER TABLE oficina
ADD COLUMN lat DECIMAL(10, 7),
ADD COLUMN lng DECIMAL(10, 7);


UPDATE oficina
SET lat = -23.5505, lng = -46.6333
WHERE id = 1;
-- Oficina 2: Mecânica Express Motul
UPDATE oficina
SET lat = -23.5550, lng = -46.6500
WHERE id = 2;

-- Oficina 3: Oficina Master Motul
UPDATE oficina
SET lat = -23.5470, lng = -46.6450
WHERE id = 3;



DESCRIBE oficina;
SELECT id, nome, lat, lng FROM oficina;
DELETE FROM oficina WHERE id IN (4, 5, 6);

